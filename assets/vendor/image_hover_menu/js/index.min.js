(function($){const map=(x,a,b,c,d)=>(x-a)*(d-c)/(b-a)+c;const lerp=(a,b,n)=>(1-n)*a+n*b;const clamp=(num,min,max)=>num<=min?min:num>=max?max:num;const getCursorPos=ev=>{return{x:ev.clientX,y:ev.clientY}};let mousepos={x:0,y:0};let mousePosCache=mousepos;let direction={x:mousePosCache.x-mousepos.x,y:mousePosCache.y-mousepos.y};window.addEventListener("mousemove",ev=>mousepos=getCursorPos(ev));class MenuItem{constructor(el,inMenuPosition,animatableProperties,total){this.DOM={el:el};this.inMenuPosition=inMenuPosition;this.imageZIndex=total;this.animatableProperties=animatableProperties;this.DOM.textInner=this.DOM.el.querySelector(".menu__item-textinner");this.DOM.imgInner="";if(typeof $(this.DOM.el).data("img")!=="undefined"){this.DOM.imgInner=$(this.DOM.el).data("img")}this.layout();this.initEvents()}layout(){this.DOM.reveal=document.createElement("div");if(this.DOM.imgInner){this.DOM.reveal.className="as-hover-reveal";this.DOM.reveal.style.transformOrigin="0% 0%";this.DOM.revealInner=document.createElement("div");this.DOM.revealInner.className="as-hover-reveal__inner";this.DOM.revealImage=document.createElement("img");this.DOM.revealImage.className="as-hover-reveal__img";this.DOM.revealImage.src=this.DOM.imgInner;this.DOM.revealInner.appendChild(this.DOM.revealImage);this.DOM.reveal.appendChild(this.DOM.revealInner);this.DOM.el.appendChild(this.DOM.reveal)}}getMouseArea(){return this.bounds.el.top+this.bounds.el.height/2<=window.innerHeight/2?"up":"down"}getMouseAreaHorizontal(){return mousepos.x+this.bounds.reveal.width<window.innerWidth?"left":"right"}calcBounds(){this.bounds={el:this.DOM.el.getBoundingClientRect(),reveal:this.DOM.reveal.getBoundingClientRect()}}initEvents(){this.mouseenterFn=ev=>{this.showImage();this.firstRAFCycle=true;this.DOM.reveal.style.transformOrigin=`${this.mouseAreaY==="left"?0:100}% ${this.mouseArea==="up"?0:100}%`;this.loopRender()};this.mouseleaveFn=()=>{this.stopRendering();this.hideImage()};this.mousemoveFn=()=>{this.calcBounds();this.mouseAreaY=this.getMouseAreaHorizontal()};this.DOM.el.addEventListener("mouseenter",this.mouseenterFn);this.DOM.el.addEventListener("mouseleave",this.mouseleaveFn);this.DOM.el.addEventListener("mouseover",this.mousemoveFn)}showImage(){if(this.DOM.imgInner){gsap.killTweensOf(this.DOM.revealInner);gsap.killTweensOf(this.DOM.revealImage);this.tl=gsap.timeline({onStart:()=>{this.DOM.reveal.style.opacity=this.DOM.revealInner.style.opacity=1;gsap.set(this.DOM.el,{zIndex:this.imageZIndex})}}).to(this.DOM.revealInner,.6,{ease:"Expo.easeOut",startAt:{scale:.6},scale:1}).to(this.DOM.revealImage,.6,{ease:"Expo.easeOut",startAt:{scale:1.4,filter:"blur(8px) brightness(2)"},scale:1,filter:"blur(0px) brightness(1)"},0)}}hideImage(){if(this.DOM.imgInner){gsap.killTweensOf(this.DOM.revealInner);gsap.killTweensOf(this.DOM.revealImage);this.tl=gsap.timeline({onStart:()=>{gsap.set(this.DOM.el,{zIndex:1})},onComplete:()=>{gsap.set(this.DOM.reveal,{opacity:0})}}).to(this.DOM.revealInner,.6,{ease:"Expo.easeOut",scale:.6,opacity:0}).to(this.DOM.revealImage,.6,{ease:"Expo.easeOut",scale:1.4},0)}}loopRender(){if(!this.requestId){this.requestId=requestAnimationFrame(()=>this.render())}}stopRendering(){if(this.requestId){window.cancelAnimationFrame(this.requestId);this.requestId=undefined}}render(){this.requestId=undefined;if(this.firstRAFCycle){this.calcBounds();this.mouseArea=this.getMouseArea();this.mouseAreaY=this.getMouseAreaHorizontal()}const mouseDistanceX=clamp(Math.abs(mousePosCache.x-mousepos.x),0,100);direction={x:mousePosCache.x-mousepos.x,y:mousePosCache.y-mousepos.y};mousePosCache={x:mousepos.x,y:mousepos.y};this.animatableProperties.tx.current=this.mouseAreaY==="left"?Math.abs(mousepos.x-this.bounds.el.left):Math.abs(mousepos.x-this.bounds.el.left)-this.bounds.reveal.width;this.animatableProperties.ty.current=this.mouseArea==="up"?Math.abs(mousepos.y-this.bounds.el.top):Math.abs(mousepos.y-this.bounds.el.top)-this.bounds.reveal.height;this.animatableProperties.rotation.current=this.firstRAFCycle?0:map(mouseDistanceX,0,175,0,direction.x<0?this.mouseArea==="up"?60:-60:this.mouseArea==="up"?-60:60);this.animatableProperties.brightness.current=this.firstRAFCycle?1:map(mouseDistanceX,0,100,1,8);this.animatableProperties.tx.previous=this.firstRAFCycle?this.animatableProperties.tx.current:lerp(this.animatableProperties.tx.previous,this.animatableProperties.tx.current,this.animatableProperties.tx.amt);this.animatableProperties.ty.previous=this.firstRAFCycle?this.animatableProperties.ty.current:lerp(this.animatableProperties.ty.previous,this.animatableProperties.ty.current,this.animatableProperties.ty.amt);this.animatableProperties.rotation.previous=this.firstRAFCycle?this.animatableProperties.rotation.current:lerp(this.animatableProperties.rotation.previous,this.animatableProperties.rotation.current,this.animatableProperties.rotation.amt);this.animatableProperties.brightness.previous=this.firstRAFCycle?this.animatableProperties.brightness.current:lerp(this.animatableProperties.brightness.previous,this.animatableProperties.brightness.current,this.animatableProperties.brightness.amt);gsap.set(this.DOM.reveal,{x:this.animatableProperties.tx.previous,y:this.animatableProperties.ty.previous,rotation:this.animatableProperties.rotation.previous,filter:`brightness(${this.animatableProperties.brightness.previous})`});this.firstRAFCycle=false;this.loopRender()}}class Menu{constructor(el){this.DOM={el:el};this.DOM.menuItems=this.DOM.el.querySelectorAll(".as-image-hover-item");this.animatableProperties={tx:{previous:0,current:0,amt:.08},ty:{previous:0,current:0,amt:.08},rotation:{previous:0,current:0,amt:.08},brightness:{previous:1,current:1,amt:.08}};this.menuItems=[];[...this.DOM.menuItems].forEach((item,pos)=>this.menuItems.push(new MenuItem(item,pos,this.animatableProperties,this.DOM.menuItems.length)));gsap.from(this.DOM.menuItems,{scrollTrigger:{trigger:this.DOM.menuItems},duration:1.2,ease:"Expo.easeOut",opacity:0,y:"100%",stagger:.2,delay:pos=>pos*.05})}}$(document).ready(function(){$(".as-image-hover-menu").each(function(i,el){$(this).imagesLoaded(function(){new Menu(el)})})})})(jQuery);